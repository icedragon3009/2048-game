<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡åŠ è½½æ€§èƒ½æµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5;
        }
        .test-container { 
            background: white; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        img { max-width: 300px; border: 1px solid #ddd; margin: 10px; border-radius: 5px; }
        .spinner { 
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .metric-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #007bff;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        .metric-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>ğŸš€ 2048æ¸¸æˆå›¾ç‰‡åŠ è½½æ€§èƒ½æµ‹è¯•</h1>
    
    <div class="test-container">
        <h2>ğŸ“Š ä¼˜åŒ–å‰åå¯¹æ¯”</h2>
        <div class="metrics">
            <div class="metric-card">
                <div class="metric-value">3.5MB</div>
                <div class="metric-label">ä¼˜åŒ–å‰æ–‡ä»¶å¤§å°</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">656KB</div>
                <div class="metric-label">ä¼˜åŒ–åæ–‡ä»¶å¤§å°</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">82%</div>
                <div class="metric-label">æ–‡ä»¶å¤§å°å‡å°‘</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="load-time">æµ‹è¯•ä¸­...</div>
                <div class="metric-label">å®é™…åŠ è½½æ—¶é—´</div>
            </div>
        </div>
    </div>

    <div class="test-container">
        <h2>ğŸ–¼ï¸ å›¾ç‰‡åŠ è½½æµ‹è¯•</h2>
        <div id="test-results"></div>
        
        <h3>ä¼˜åŒ–åçš„æ­è½¦å›¾ç‰‡ï¼š</h3>
        <div id="optimized-image-container">
            <div class="spinner"></div> æ­£åœ¨åŠ è½½ä¼˜åŒ–åå›¾ç‰‡...
        </div>
        
        <h3>äºŒç»´ç å›¾ç‰‡ï¼š</h3>
        <div id="qr-image-container">
            <div class="spinner"></div> æ­£åœ¨åŠ è½½äºŒç»´ç å›¾ç‰‡...
        </div>
        
        <button onclick="runPerformanceTest()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 10px 0;">
            ğŸ”„ é‡æ–°æµ‹è¯•åŠ è½½é€Ÿåº¦
        </button>
    </div>

    <div class="test-container">
        <h2>âœ¨ ä¼˜åŒ–æŠ€æœ¯è¯´æ˜</h2>
        <div class="test-result info">
            <strong>1. å›¾ç‰‡å‹ç¼©ä¼˜åŒ–ï¼š</strong>
            ä½¿ç”¨sipså·¥å…·å°†3.5MBçš„PNGå›¾ç‰‡å‹ç¼©è‡³656KBï¼Œå‡å°‘82%æ–‡ä»¶å¤§å°
        </div>
        <div class="test-result info">
            <strong>2. é¢„åŠ è½½æœºåˆ¶ï¼š</strong>
            æ¸¸æˆå¯åŠ¨æ—¶åœ¨åå°é¢„åŠ è½½å›¾ç‰‡ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
        </div>
        <div class="test-result info">
            <strong>3. åŠ è½½åŠ¨ç”»ï¼š</strong>
            æ˜¾ç¤ºæ—‹è½¬åŠ è½½åŠ¨ç”»ï¼Œè®©ç”¨æˆ·äº†è§£åŠ è½½è¿›åº¦
        </div>
        <div class="test-result info">
            <strong>4. Service Workerç¼“å­˜ï¼š</strong>
            ç¬¬äºŒæ¬¡è®¿é—®æ—¶ä»ç¼“å­˜åŠ è½½ï¼Œå‡ ä¹æ— å»¶è¿Ÿ
        </div>
        <div class="test-result info">
            <strong>5. æ‡’åŠ è½½ç­–ç•¥ï¼š</strong>
            åªæœ‰åœ¨éœ€è¦æ˜¾ç¤ºå›¾ç‰‡æ—¶æ‰å¼€å§‹åŠ è½½
        </div>
    </div>

    <script>
        // è®°å½•é¡µé¢åŠ è½½æ—¶é—´
        const pageLoadStart = performance.now();
        
        // å›¾ç‰‡åŠ è½½æ€§èƒ½æµ‹è¯•
        function testImageLoad(url, containerId, description) {
            const container = document.getElementById(containerId);
            const startTime = performance.now();
            
            const img = new Image();
            img.onload = function() {
                const loadTime = performance.now() - startTime;
                container.innerHTML = `
                    <div class="test-result success">
                        âœ… ${description} åŠ è½½æˆåŠŸï¼è€—æ—¶: ${loadTime.toFixed(2)}ms
                    </div>
                    <img src="${url}" alt="${description}">
                `;
                
                // æ›´æ–°æ€»åŠ è½½æ—¶é—´
                updateLoadTime();
            };
            
            img.onerror = function() {
                const loadTime = performance.now() - startTime;
                container.innerHTML = `
                    <div class="test-result warning">
                        âš ï¸ ${description} åŠ è½½å¤±è´¥ï¼è€—æ—¶: ${loadTime.toFixed(2)}ms
                    </div>
                `;
            };
            
            img.src = url;
        }
        
        function updateLoadTime() {
            const totalTime = performance.now() - pageLoadStart;
            document.getElementById('load-time').textContent = `${(totalTime/1000).toFixed(2)}s`;
        }
        
        function runPerformanceTest() {
            document.getElementById('test-results').innerHTML = `
                <div class="test-result info">
                    <div class="spinner"></div> æ­£åœ¨è¿›è¡Œæ€§èƒ½æµ‹è¯•...
                </div>
            `;
            
            const tests = [
                { url: 'static/dache.png', name: 'æ­è½¦å›¾ç‰‡', size: '656KB' },
                { url: 'static/wechat-qr.png', name: 'äºŒç»´ç å›¾ç‰‡', size: '160KB' }
            ];
            
            let completedTests = 0;
            const results = [];
            
            tests.forEach((test, index) => {
                const startTime = performance.now();
                const img = new Image();
                
                img.onload = function() {
                    const loadTime = performance.now() - startTime;
                    results[index] = {
                        name: test.name,
                        size: test.size,
                        time: loadTime.toFixed(2),
                        status: 'success'
                    };
                    
                    completedTests++;
                    if (completedTests === tests.length) {
                        displayResults(results);
                    }
                };
                
                img.onerror = function() {
                    const loadTime = performance.now() - startTime;
                    results[index] = {
                        name: test.name,
                        size: test.size,
                        time: loadTime.toFixed(2),
                        status: 'error'
                    };
                    
                    completedTests++;
                    if (completedTests === tests.length) {
                        displayResults(results);
                    }
                };
                
                img.src = test.url + '?t=' + Date.now(); // é¿å…ç¼“å­˜
            });
        }
        
        function displayResults(results) {
            let html = '<h4>ğŸ“ˆ æµ‹è¯•ç»“æœï¼š</h4>';
            results.forEach(result => {
                const statusClass = result.status === 'success' ? 'success' : 'warning';
                const statusIcon = result.status === 'success' ? 'âœ…' : 'âŒ';
                html += `
                    <div class="test-result ${statusClass}">
                        ${statusIcon} ${result.name} (${result.size}) - åŠ è½½æ—¶é—´: ${result.time}ms
                    </div>
                `;
            });
            document.getElementById('test-results').innerHTML = html;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹æµ‹è¯•
        window.addEventListener('load', () => {
            // æµ‹è¯•å›¾ç‰‡åŠ è½½
            testImageLoad('static/dache.png?v=' + Date.now(), 'optimized-image-container', 'ä¼˜åŒ–åæ­è½¦å›¾ç‰‡');
            testImageLoad('static/wechat-qr.png', 'qr-image-container', 'äºŒç»´ç å›¾ç‰‡');
            
            // è‡ªåŠ¨è¿è¡Œæ€§èƒ½æµ‹è¯•
            setTimeout(runPerformanceTest, 1000);
        });
    </script>
</body>
</html>